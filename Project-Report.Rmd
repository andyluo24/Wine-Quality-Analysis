---
title: "STAT 420: Final Project"
date: "12/10/2020"
output:
  html_document:
    theme: readable
    toc: yes
---

# Introduction

## Data Description

Two datasets from the Machine Learning Repository of UCI will be used for this project.

The first dataset "winequality-red" contains the red wine data in the northern Portugal area, while the second dataset "winequality-white" contains the white wine data. 

For analysis purposes, we classify all the observations based on their color types and merge them into one dataset.

The complete dataset has 6497 observations with 13 variables. 

Among the 13 variables, 12 variables are numeric attributes and 1 variable is a categorical attribute.

Numeric attributes: 

**fixed.acidity**, **volatile.acidity**, **citric.acid**, **residual.sugar**, **chlorides**, **free.sulfur.dioxide**, **total.sulfur.dioxide**, **density**, **pH**, **sulphates**, **alcohol**, **quality**   

Categorical attributes:

**Type (Red / White)**

## Project Description

Wine, as one type of alcohol, has a total consumption of 966 million in the US in 2018. 
  
Therefore, we find it may be interesting to discover the relationship between wine quality and other attributes. 
  
Then we will build a model to predict the wine quality based on those attributes. 
  
In this project, we will use "Quality" as the response variable and all other attributes as predictor variables to discover the most appropriate model.

# Methods

## Data Preprocessing

```{r dp0, message = FALSE}
# Load required packages
library(tidyverse)
library(caret)
library(leaps)

# Set seed for report consistency
set.seed(420)
```

```{r dp1}
# Import two datasets
redwine = read.csv("winequality-red.csv")
whitewine  = read.csv("winequality-white.csv")

# Add Classification "red" and "white" and merge them as one dataset
redwine$type = "red"
whitewine$type = "white"
wine = rbind(redwine, whitewine)
str(wine)
```

There are 6497 observations with 13 variables in this combined dataset.

Among 13 variables, 12 variables are numeric attributes and 1 variable is catergorical attribute.

Since the original datasets are clean-version data, we don't need to perform further data cleansing.

```{r dp2}
# Cross-validation
# 80% of the dataset for training purpose and 20% of the dataset for testing purpose
random_sample = createDataPartition(wine$quality, p = 0.8, list = FALSE)
training_data = wine[random_sample, ]
testing_data = wine[-random_sample, ]
```

## Model Training

### Interaction Model

```{r IM0}
# Reproduce the training_data and factor the dummy variable "type"
training_data_IM = training_data
training_data_IM$type = as.factor(training_data_IM$type)
four_way_interaction_model = lm(quality ~ .^4, data = training_data_IM)
three_way_interaction_model = lm(quality ~ .^3, data = training_data_IM)
two_way_interaction_model = lm(quality ~ .^2, data = training_data_IM)
one_way_interaction_model = lm(quality ~ ., data = training_data_IM)
```

```{r IM1}
anova(one_way_interaction_model, two_way_interaction_model)$"Pr(>F)"[2]
```

Since p-value is smaller than 0.05, we reject the null hypothesis and conclude that the "two_way_interaction_model" is better.

```{r IM2}
anova(two_way_interaction_model, three_way_interaction_model)$"Pr(>F)"[2]
```

Since p-value is smaller than 0.05, we reject the null hypothesis and conclude that the "three_way_interaction_model" is better.

```{r IM3}
anova(three_way_interaction_model, four_way_interaction_model)$"Pr(>F)"[2]
```

Since p-value is smaller than 0.05, we reject the null hypothesis and conclude that the "four_way_interaction_model" is better.

We will leave this model for future comparisons with other potential models.

### Stepwise/Exhaustive Search Model

```{r SM0}
# Reproduce the training_data
training_data_SM = training_data

# stepwise selection model
start_model = lm(quality ~ 1, data = training_data_SM)
add_model = lm(quality ~ ., data = training_data_SM)

# stepwise aic model
stepwise_model_aic = step(start_model, scope = quality ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + total.sulfur.dioxide + density + pH + sulphates + alcohol + type, direction = "both", trace = 0)

#s stepwise bic model
stepwise_model_bic = step(start_model, scope = quality ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide + total.sulfur.dioxide + density + pH + sulphates + alcohol + type, direction = "both", trace = 0, k = log(length(resid(add_model))))

# exhaustive model

```

### To add on

```{r }

```

# Results

# Discussion

# Appendix